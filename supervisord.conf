[supervisord]
nodaemon=true
loglevel=info
; stream logs to container stdout/stderr
logfile=/dev/null
pidfile=/var/run/supervisord.pid

; ----- Web (Django + Gunicorn) -----
[program:web]
directory=/app
; If you want collectstatic every start, keep it; otherwise gate with $COLLECTSTATIC
command=/bin/sh -c 'wait_for_db && \
  python manage.py migrate && \
  gunicorn storesaas.wsgi:application --bind :8352'

autostart=true
autorestart=true
startsecs=5
startretries=10
stopasgroup=true
killasgroup=true
stdout_logfile=/dev/stdout
stderr_logfile=/dev/stderr
stdout_logfile_maxbytes=0
stderr_logfile_maxbytes=0
; Example: increase workers via env var GUNICORN_WORKERS
environment=GUNICORN_WORKERS="4"

; ----- Django Q Cluster -----
[program:qcluster]
directory=/app
command=/bin/sh -c 'wait_for_db && python manage.py qcluster'
autostart=true
autorestart=true
startsecs=5
startretries=10
stopasgroup=true
killasgroup=true
stdout_logfile=/dev/stdout
stderr_logfile=/dev/stderr
stdout_logfile_maxbytes=0
stderr_logfile_maxbytes=0
